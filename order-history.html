<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Order History â€“ Oak & Linen</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- ================= FIREBASE ================= -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import {
    getFirestore,
    collection,
    query,
    where,
    getDocs
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBI3u_ZBnh-9IpLr6I4iUNG7IDo3hzV6ds",
    authDomain: "oak-n-linen-project.firebaseapp.com",
    projectId: "oak-n-linen-project",
    storageBucket: "oak-n-linen-project.firebasestorage.app",
    messagingSenderId: "783016997772",
    appId: "1:783016997772:web:2d9e352bdcc1ad4eba1ca9"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  function mapStatus(status) {
    if (status === "New") return "Placed Order";
    return status;
  }

  window.searchOrders = async () => {
    const email = document.getElementById("email").value.trim();
    const tbody = document.getElementById("ordersBody");
    tbody.innerHTML = "";

    if (!email) {
      alert("Please enter your email address.");
      return;
    }

    const q = query(collection(db, "orders"), where("email", "==", email));
    const snap = await getDocs(q);

    if (snap.empty) {
      tbody.innerHTML = `<tr><td colspan="7">No orders found.</td></tr>`;
      return;
    }

    snap.forEach(doc => {
      const o = doc.data();
      const orderDate = o.createdAt?.toDate().toLocaleDateString() || "â€”";
      const status = mapStatus(o.status);

      o.items.forEach(item => {
        const canRequest = status === "Delivered";

        tbody.innerHTML += `
          <tr>
            <td>${doc.id.slice(0,6)}</td>
            <td>${orderDate}</td>
            <td>${item.product}</td>
            <td>${item.qty}</td>
            <td>â‚¬${item.price}</td>
            <td><strong>${status}</strong></td>
            <td>
              ${
                canRequest
                ? `<a class="action-btn"
                     href="return-refund.html?orderId=${doc.id}&product=${encodeURIComponent(item.product)}">
                     Return / Refund
                   </a>`
                : "â€”"
              }
            </td>
          </tr>
        `;
      });
    });
  };
</script>

<!-- ================= STYLES ================= -->
<style>
*{box-sizing:border-box;font-family:"Segoe UI",Arial}
body{
  margin:0;
  background:#EFE7E1;
  color:#2B2B2B;
  min-height:100vh;
  display:flex;
  flex-direction:column;
}

/* ===== HEADER ===== */
header{
  background:#fff;
  border-bottom:4px solid #3E2723;
  padding:18px 36px;
}

.header-container{
  max-width:1200px;
  margin:auto;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.logo{
  display:flex;
  align-items:center;
  gap:10px;
  font-size:22px;
  font-weight:bold;
  color:#3E2723;
  text-decoration:none;
}

.logo-icon{
  width:40px;
  height:40px;
  background:#3E2723;
  color:#C6A75E;
  border-radius:8px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
}

nav a{
  margin-left:24px;
  font-weight:600;
  color:#2B2B2B;
  text-decoration:none;   /* ðŸ”¥ remove underline */
}

/* ===== MAIN ===== */
main{
  flex:1;
  max-width:1200px;
  margin:40px auto;
  padding:0 36px;
}

h1, h2, h3{
  text-decoration:none;  /* ðŸ”¥ ensure no underline */
}

input,button{
  padding:12px;
  border-radius:8px;
  border:1px solid #ccc;
}

button{
  background:#2E5E4E;
  color:#fff;
  font-weight:bold;
  border:none;
  cursor:pointer;
}

/* ===== TABLE ===== */
table{
  width:100%;
  border-collapse:collapse;
  background:#fff;
  border-radius:14px;
  overflow:hidden;
  box-shadow:0 8px 22px rgba(0,0,0,.08);
}

th,td{
  padding:14px;
  border-bottom:1px solid #eee;
}

th{
  background:#3E2723;
  color:#fff;
}

/* ===== ACTION BUTTON ===== */
.action-btn{
  background:#2E5E4E;
  color:#fff;
  padding:8px 14px;
  border-radius:6px;
  font-weight:600;
  text-decoration:none;  /* ðŸ”¥ no underline */
  display:inline-block;
}

/* ===== FOOTER ===== */
footer{
  background:#3E2723;
  color:#EFE7E1;
  text-align:center;
  padding:24px;
  font-size:14px;
}
</style>
</head>

<body>

<header>
  <div class="header-container">
    <a href="index.html" class="logo">
      <div class="logo-icon">OL</div> Oak & Linen
    </a>
    <nav>
      <a href="index.html">Home</a>
      <a href="products.html">Products</a>
      <a href="cart.html">Cart<span id="cartCount"></span></a>
      <a href="order.html">Place Order</a>
      <a href="order-history.html">Order History</a>
      <a href="order-management.html">Order Management</a>
      <a href="operations.html">Operations</a>
    </nav>
  </div>
</header>

<main>
  <h1>Order History & Tracking</h1>
  <p>Enter the email used to place your order.</p>

  <input id="email" placeholder="customer@email.com">
  <button onclick="searchOrders()">View Orders</button>

  <br><br>

  <table>
    <thead>
      <tr>
        <th>Order</th>
        <th>Date</th>
        <th>Product</th>
        <th>Qty</th>
        <th>Price</th>
        <th>Status</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="ordersBody"></tbody>
  </table>
</main>

<footer>
  Â© 2025 Oak & Linen Furniture. All rights reserved.
</footer>

<!-- ================= CART + LIKE LOGIC ================= -->
<script>
  function addToCart(product, price) {
    let cart = JSON.parse(localStorage.getItem("cart")) || [];

    const item = cart.find(i => i.product === product);
    if (item) item.qty++;
    else cart.push({ product, price, qty: 1 });

    localStorage.setItem("cart", JSON.stringify(cart));
    updateCartCount();
    showFeedback(product);
  }

  function updateCartCount() {
    const cart = JSON.parse(localStorage.getItem("cart")) || [];
    const count = cart.reduce((sum, i) => sum + i.qty, 0);
    document.getElementById("cartCount").innerText = count ? `(${count})` : "";
  }

  function showFeedback(product) {
    const msg = document.getElementById("cartFeedback");
    msg.innerText = `${product} added to cart`;
    msg.style.display = "block";
    setTimeout(() => msg.style.display = "none", 2000);
  }

  function toggleLike(btn) {
    btn.classList.toggle("liked");
  }

  updateCartCount();
</script>

</body>
</html>
