<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Order History â€“ Oak & Linen</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- ================= FIREBASE ================= -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import {
    getFirestore,
    collection,
    query,
    where,
    getDocs
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBI3u_ZBnh-9IpLr6I4iUNG7IDo3hzV6ds",
    authDomain: "oak-n-linen-project.firebaseapp.com",
    projectId: "oak-n-linen-project",
    storageBucket: "oak-n-linen-project.firebasestorage.app",
    messagingSenderId: "783016997772",
    appId: "1:783016997772:web:2d9e352bdcc1ad4eba1ca9"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  function mapStatus(status) {
    if (status === "New") return "Placed Order";
    return status;
  }

  window.searchOrders = async () => {
    const email = document.getElementById("email").value.trim();
    const tbody = document.getElementById("ordersBody");
    tbody.innerHTML = "";

    if (!email) {
      alert("Please enter your email address.");
      return;
    }

    const q = query(collection(db, "orders"), where("email", "==", email));
    const snap = await getDocs(q);

    if (snap.empty) {
      tbody.innerHTML = `<tr><td colspan="7">No orders found.</td></tr>`;
      return;
    }

    snap.forEach(doc => {
      const o = doc.data();
      const orderDate = o.createdAt?.toDate().toLocaleDateString() || "â€”";
      const status = mapStatus(o.status);

      o.items.forEach(item => {
        const canRequest = status === "Delivered";

        tbody.innerHTML += `
          <tr>
            <td>${doc.id.slice(0,6)}</td>
            <td>${orderDate}</td>
            <td>${item.product}</td>
            <td>${item.qty}</td>
            <td>â‚¬${item.price}</td>
            <td><strong>${status}</strong></td>
            <td>
              ${
                canRequest
                ? `<a class="action-btn"
                     href="return-refund.html?orderId=${doc.id}&product=${encodeURIComponent(item.product)}">
                     Return / Refund
                   </a>`
                : "â€”"
              }
            </td>
          </tr>
        `;
      });
    });
  };
</script>

<!-- ================= STYLES ================= -->
<style>
*{box-sizing:border-box;font-family:"Segoe UI",Arial}
body{
  margin:0;
  background:#EFE7E1;
  color:#2B2B2B;
  min-height:100vh;
  display:flex;
  flex-direction:column;
}

/* ===== HEADER ===== */
header{
  background:#fff;
  border-bottom:4px solid #3E2723;
  padding:18px 36px;
}

.header-container{
  max-width:1200px;
  margin:auto;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.logo{
  display:flex;
  align-items:center;
  gap:10px;
  font-size:22px;
  font-weight:bold;
  color:#3E2723;
  text-decoration:none;
}

.logo-icon{
  width:40px;
  height:40px;
  background:#3E2723;
  color:#C6A75E;
  border-radius:8px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
}

nav a{
  margin-left:24px;
  font-weight:600;
  color:#2B2B2B;
  text-decoration:none;
}

/* Cart count badge â€“ SAME as other pages */
#cartCount{
  background:#2E5E4E;
  color:#ffffff;
  border-radius:12px;
  padding:2px 8px;
  font-size:12px;
  margin-left:6px;
  font-weight:600;
}


/* ===== MAIN ===== */
main{
  flex:1;
  max-width:1200px;
  margin:40px auto;
  padding:0 36px;
}

input,button{
  padding:12px;
  border-radius:8px;
  border:1px solid #ccc;
}

button{
  background:#2E5E4E;
  color:#fff;
  font-weight:bold;
  border:none;
  cursor:pointer;
}

/* ===== TABLE ===== */
table{
  width:100%;
  border-collapse:collapse;
  background:#fff;
  border-radius:14px;
  overflow:hidden;
  box-shadow:0 8px 22px rgba(0,0,0,.08);
}

th,td{
  padding:14px;
  border-bottom:1px solid #eee;
}

th{
  background:#3E2723;
  color:#fff;
}

/* ===== ACTION BUTTON ===== */
.action-btn{
  background:#2E5E4E;
  color:#fff;
  padding:8px 14px;
  border-radius:6px;
  font-weight:600;
  text-decoration:none;
  display:inline-block;
}

/* ===== ORDER HISTORY LAYOUT (SIDEBAR) ===== */
.order-layout {
  display: grid;
  grid-template-columns: 260px 1fr;
  gap: 40px;

  max-width: none;
  margin: 0;
  padding: 40px 36px;
}

/* LEFT SIDEBAR */
.order-sidebar {
  background: #fff;
  border-radius: 14px;
  padding: 24px;
  box-shadow: 0 6px 20px rgba(0,0,0,.08);
  height: fit-content;
}

.sidebar-title {
  color: #3E2723;
  margin-bottom: 20px;
  font-size: 18px;
}

/* SIDEBAR LINKS */
.sidebar-link {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 12px 14px;
  border-radius: 10px;
  margin-bottom: 10px;
  font-weight: 600;
  color: #3E2723;
  text-decoration: none;
  transition: background .2s ease, color .2s ease;
}

.sidebar-link:hover {
  background: rgba(46, 94, 78, 0.12);
  color: #2E5E4E;
}

.sidebar-link.active {
  background: #2E5E4E;
  color: #fff;
}

/* RIGHT CONTENT */
.order-content h1 {
  margin-top: 0;
  text-align: center;
  margin-bottom: 20px;
}

/* MOBILE */
@media (max-width: 768px) {
  .order-layout {
    grid-template-columns: 1fr;
  }

  .order-sidebar {
    display: flex;
    gap: 10px;
    overflow-x: auto;
  }

  .sidebar-link {
    white-space: nowrap;
    margin-bottom: 0;
  }
}


/* ===== FOOTER ===== */
footer{
  background:#3E2723;
  color:#EFE7E1;
  text-align:center;
  padding:24px;
  font-size:14px;
}

/* ===== FOOTER (GLOBAL â€“ SAME AS HOME) ===== */
footer {
  background: #3E2723;
  color: #EFE7E1;
  padding: 50px 36px;
  font-size: 14px;
}

.footer-container {
  max-width: 1000px;
  margin: auto;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 30px;
  text-align: left;
}

.footer-section h4 {
  color: #C6A75E;
  margin-bottom: 14px;
}

.footer-section a,
.footer-section p {
  display: block;
  color: #EFE7E1;
  margin-bottom: 8px;
  text-decoration: none;
}

.footer-section a:hover {
  text-decoration: underline;
}

.social a {
  margin-right: 12px;
}

.footer-bottom {
  text-align: center;
  margin-top: 30px;
  color: #D7CFC8;
  font-size: 13px;
}

</style>
</head>

<body>

<header>
  <div class="header-container">
    <a href="index.html" class="logo">
      <div class="logo-icon">OL</div> Oak & Linen
    </a>
    <nav>
      <a href="index.html">Home</a>
      <a href="products.html">Products</a>
      <a href="cart.html">ðŸ›’ Cart<span id="cartCount"></span></a>
    </nav>
  </div>
</header>

<main class="order-layout">

  <!-- LEFT SIDEBAR -->
  <aside class="order-sidebar">
    <h3 class="sidebar-title">Order History</h3>

    <a href="cart.html" class="sidebar-link">
      Cart
    </a>

    <a href="order.html" class="sidebar-link">
      Place Order
    </a>

    <a href="order-history.html" class="sidebar-link active">
      Order History
    </a>

    <a href="return-refund.html" class="sidebar-link">
      Returns & Refunds
    </a>
  </aside>

  <!-- RIGHT CONTENT -->
  <section class="order-content">

    <h1>Order History & Tracking</h1>
    <p>Enter the email used to place your order.</p>

    <input id="email" placeholder="customer@email.com">
    <button onclick="searchOrders()">View Orders</button>

    <br><br>

    <table>
      <thead>
        <tr>
          <th>Order</th>
          <th>Date</th>
          <th>Product</th>
          <th>Qty</th>
          <th>Price</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="ordersBody"></tbody>
    </table>

  </section>

</main>


<footer>
  <div class="footer-container">

    <div class="footer-section">
      <h4>Oak & Linen</h4>
      <p>Crafted furniture. Intelligent operations.</p>
    </div>

    <div class="footer-section">
      <h4>Customer Care</h4>
      <a href="#">Delivery Information</a>
      <a href="#">Returns & Refund Policy</a>
      <a href="#">Warranty & Repairs</a>
    </div>

    <div class="footer-section">
      <h4>Contact</h4>
      <a href="mailto:support@oakandlinen.ie">support@oakandlinen.ie</a>
      <a href="tel:+35315550199">+353 1 555 0199</a>
    </div>

    <div class="footer-section">
      <h4>Connect</h4>
      <div class="social">
        <a href="#">Instagram</a>
        <a href="#">Facebook</a>
        <a href="#">LinkedIn</a>
      </div>
    </div>

  </div>

  <div class="footer-bottom">
    Â© 2025 Oak & Linen Furniture. All rights reserved.
  </div>
</footer>

<!-- ================= SAFE CART COUNT LOGIC ================= -->
<script>
  function updateCartCount() {
    const cart = JSON.parse(localStorage.getItem("cart")) || [];
    const count = cart.reduce((sum, item) => sum + item.qty, 0);
    const badge = document.getElementById("cartCount");

    if (!badge) return;

    badge.innerText = count > 0 ? count : "";
  }

  document.addEventListener("DOMContentLoaded", updateCartCount);
</script>

</body>
</html>
